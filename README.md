# Grand Challenges ISLES 2022 Evaluation Container

This repo contains the evaluation container for the ISLES 2022 challenge (e.g. [ATLAS](https://atlas.grand-challenge.org/)). The `build.sh`, `test.sh`, `export.sh` scripts along with msot of `Dockerfile` were generated by evalutils version 0.3.1. The code presented here is not needed by participants for the challenge, but it is made available for transparency and to give participants a way to test the evaluations on their own machines.

The `Dockerfile` expects ground truth labels to be in the `ground-truth` directory. The format must be a BIDS dataset
that conforms to the user-supplied settings in `settings.py`.  
  
The settings file (`settings.py`) can be used to control data loading, which scoring functions are used, and which
summary statistics are returned. 

Adapting this code to other BIDS datasets used in other challenges should require only the following settings:
- Updating `GroundTruthBIDSDerivativeName` and `PredictionBIDSDerivativeName` to your derivative names.
- Updating `GroundTruthEntities` and `PredictionEntities` to values matching your data. See the [BIDSIO documentation](https://github.com/npnl/bidsio)
  for more information on how to use these.
- Importing your desired metrics into `settings.py` and adding them to the `ScoringFunctions` dictionary.

## Setting
### Data Setting
`external_dataset/TaskName/imagesTs/XXX_0000_0000.nii.gz` for ADC dataset  
`external_dataset/TaskName/imagesTs/XXX_0000_0001.nii.gz` for DWI dataset  
`external_dataset/TaskName/labelsTs/XXX_0000.nii.gz` for Label dataset (if exist)

### Trained Model Setting
trained models can be find in [link](https://lab.loopback.kr:50443/pub/nnUNet_model.tar)  
trained models should be positioned in `nnUNet_model/` folder  
e.g.
`nnUNet_model/3d_fullres_dwi_tf_mt` model for DWI with transfer learning & multi-tasking  
`nnUNet_model/3d_fullres_adc_dwi_tf_t2` model for ADC+DWI with transfer learning  

### Inference  
Inference should be runed with following sequence of codes.  
`bash run.sh TASKNAME 4`  # code for DWI with transfer learning & multi-tasking  
`bash run.sh TASKNAME 6`  # code for ADC+DWI with transfer learning  
`bash run.sh TASKNAME 10` # code for ensemble  
