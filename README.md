# Grand Challenges ISLES 2022 Evaluation Container

This repo contains the evaluation container for the ISLES 2022 challenge (e.g. [ATLAS](https://atlas.grand-challenge.org/)). The `build.sh`, `test.sh`, `export.sh` scripts along with msot of `Dockerfile` were generated by evalutils version 0.3.1. The code presented here is not needed by participants for the challenge, but it is made available for transparency and to give participants a way to test the evaluations on their own machines.

The `Dockerfile` expects ground truth labels to be in the `ground-truth` directory. The format must be a BIDS dataset
that conforms to the user-supplied settings in `settings.py`.  
  
The settings file (`settings.py`) can be used to control data loading, which scoring functions are used, and which
summary statistics are returned. 

Adapting this code to other BIDS datasets used in other challenges should require only the following settings:
- Updating `GroundTruthBIDSDerivativeName` and `PredictionBIDSDerivativeName` to your derivative names.
- Updating `GroundTruthEntities` and `PredictionEntities` to values matching your data. See the [BIDSIO documentation](https://github.com/npnl/bidsio)
  for more information on how to use these.
- Importing your desired metrics into `settings.py` and adding them to the `ScoringFunctions` dictionary.

## Setting Tutorial
### Data Setting
Provided that the requested Test dataset is located in the correct folder (external_dataset/TaskXXX_MYTASK).  
The modalities (ADC, DWI) in the test dataset used must be named in the correct format:  
`external_dataset/TaskXXX_MYTASK/imagesTs/XXX_0000_0000.nii.gz`: for ADC dataset  
`external_dataset/TaskXXX_MYTASK/imagesTs/XXX_0000_0001.nii.gz`: for DWI dataset  
`external_dataset/TaskXXX_MYTASK/labelsTs/XXX_0000.nii.gz`: for Label dataset (if exist)

### Inference  
The inference step consists of running the following sequence of code:  
`bash run.sh TaskXXX_MYTASK 4`: code for DWI with transfer learning & multi-tasking  
`bash run.sh TaskXXX_MYTASK 6`: code for ADC+DWI with transfer learning  
`bash run.sh TaskXXX_MYTASK 10`: code for ensemble  

### Weights trained by our proposed method
* Download: [OneDrive](https://1drv.ms/f/c/de011cb09ae2716d/Eva2LhBp1ZlKt7xvml5-pLEBwWa6p_Q_X010kX5SUwN9OQ?e=QRd9xK)
* 3d_fullres_dwi_tf_mt.zip: Single-modality(DWI) model weight with trainsfer & multi-task learning
* 3d_fullres_adc_dwi_tf_t2.zip: Multi-modality(ADC+DWI) model weight with transfer learning
* The trained models should be located in the `nnUNet_model/` folder
